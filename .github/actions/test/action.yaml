name: Test

description: 'Checkout code, setup environment, download build artifacts, and run tests'

inputs:
    repo-token:
        description: 'Token to access the repository'
        required: true
    fetch-depth:
        description: 'Git fetch depth for checkout'
        required: false
        default: '0'

runs:
    using: 'composite'
    steps:
        - name: Checkout code
          uses: actions/checkout@v6
          with:
              fetch-depth: ${{ inputs.fetch-depth }}

        - name: Prepare Environment
          uses: ./.github/actions/setup-env
          with:
              repo-token: ${{ inputs.repo-token }}

        - name: Download build artifacts
          uses: actions/download-artifact@v4
          with:
              name: build-artifacts

        - name: Test
          shell: bash
          run: |
              set -e
              npm run test
