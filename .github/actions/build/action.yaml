name: Build

description: 'Checkout code, setup environment, build project, and upload build artifacts'

inputs:
    repo-token:
        description: 'Token to access the repository'
        required: true
    fetch-depth:
        description: 'Git fetch depth for checkout'
        required: false
        default: '0'

runs:
    using: 'composite'
    steps:
        - name: Checkout code
          uses: actions/checkout@v6
          with:
              fetch-depth: ${{ inputs.fetch-depth }}

        - name: Prepare Environment
          uses: ./.github/actions/setup-env
          with:
              repo-token: ${{ inputs.repo-token }}

        - name: Build
          shell: bash
          run: |
              set -e
              npm run build

        - name: Upload build artifacts
          uses: actions/upload-artifact@v4
          with:
              name: build-artifacts
              path: |
                  **/dist/**
                  **/build/**
                  **/.next/**
              retention-days: 1
