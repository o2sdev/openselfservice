name: Build package

description: 'Builds and deploys a package to Vercel production environment'

inputs:
    vercel-token:
        description: 'Token to access Vercel'
        required: true
    pull-env-args:
        description: 'Arguments to pull environment variables from Vercel'
        required: true
    build-env-args:
        description: 'Arguments for Vercel build command'
        required: true

runs:
    using: "composite"
    steps:
        - name: Install Vercel CLI
          shell: bash
          run: |
              set -e
              npm i --global vercel

        - name: Pull environment variables from Vercel
          shell: bash
          run: |
              set -e
              vercel pull ${{ inputs.pull-env-args }} --token=${{ inputs.vercel-token }}

        - name: Build project locally
          shell: bash
          run: |
              set -e
              vercel build ${{ inputs.build-env-args }}

        - name: Deploy prebuilt project to Vercel
          shell: bash
          run: |
              set -e
              vercel deploy --prebuilt ${{ inputs.build-env-args }} --token=${{ inputs.vercel-token }}
